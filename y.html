<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Open Library Book Search & Read</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #results .book {
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #ccc;
    }
    .book h3 {
      margin: 0 0 5px;
    }
    #reader {
      margin-top: 30px;
    }
    #reader iframe {
      width: 100%;
      height: 600px;
      border: 1px solid #ccc;
    }
    .read-button {
      margin-top: 5px;
      padding: 5px 10px;
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    .read-button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>
  <h1>Book Search & Read</h1>
  <form id="searchForm">
    <input type="text" id="query" placeholder="Enter book title or author" required>
    <button type="submit">Search</button>
  </form>
  
  <div id="results"></div>
  
  <!-- This section will load the book reader if available -->
  <div id="reader"></div>

  <script>
    // Function to clear the reader view
    function clearReader() {
      document.getElementById("reader").innerHTML = "";
    }

    document.getElementById("searchForm").addEventListener("submit", function(e) {
      e.preventDefault(); // Prevent form submission from refreshing the page
      clearReader(); // Clear any open reader
      const query = document.getElementById("query").value;
      const resultsDiv = document.getElementById("results");
      resultsDiv.innerHTML = "<p>Loading...</p>";

      // Use the Open Library search API
      fetch("https://openlibrary.org/search.json?q=" + encodeURIComponent(query))
        .then(response => response.json())
        .then(data => {
          resultsDiv.innerHTML = "";
          if (!data.docs || data.docs.length === 0) {
            resultsDiv.innerHTML = "<p>No results found.</p>";
            return;
          }
          // Loop through each book result
          data.docs.forEach(book => {
            const div = document.createElement("div");
            div.className = "book";
            const title = book.title ? book.title : "No Title";
            const authors = book.author_name ? book.author_name.join(", ") : "Unknown Author";
            div.innerHTML = `<h3>${title}</h3><p><strong>Author(s):</strong> ${authors}</p>`;

            // Check if the book has a digital version available via Internet Archive
            // The "ia" field contains Internet Archive identifiers if available.
            if (book.ia && book.ia.length > 0) {
              const readBtn = document.createElement("button");
              readBtn.className = "read-button";
              readBtn.textContent = "Read";
              // When clicked, embed the reader using the first identifier from the ia array
              readBtn.addEventListener("click", function() {
                // Construct the embed URL for the Internet Archive reader
                // Note: This uses the Internet Archive embed service.
                const iaId = book.ia[0];
                const embedUrl = `https://archive.org/embed/${iaId}?ui=embed`;
                document.getElementById("reader").innerHTML = `<h2>Reading: ${title}</h2><iframe src="${embedUrl}" frameborder="0" allowfullscreen></iframe>`;
                // Optionally scroll to the reader section
                document.getElementById("reader").scrollIntoView({ behavior: "smooth" });
              });
              div.appendChild(readBtn);
            } else {
              // If no digital version is available, you might link to the Open Library details page
              const infoLink = document.createElement("a");
              infoLink.href = `https://openlibrary.org${book.key}`;
              infoLink.target = "_blank";
              infoLink.textContent = "View Details";
              div.appendChild(infoLink);
            }
            resultsDiv.appendChild(div);
          });
        })
        .catch(error => {
          resultsDiv.innerHTML = "<p>Error retrieving results.</p>";
          console.error("Error fetching data:", error);
        });
    });
  </script>
</body>
</html>
